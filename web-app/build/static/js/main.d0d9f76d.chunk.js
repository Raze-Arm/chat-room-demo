(this["webpackJsonpwebrtc-web"]=this["webpackJsonpwebrtc-web"]||[]).push([[0],{161:function(e,n,t){},167:function(e,n,t){},170:function(e,n,t){},171:function(e,n,t){},175:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),o=t(41),r=t.n(o),i=t(192),s=t(39),u=Object(s.a)(),d=t(18),l=t(197),m=(t(161),t(2)),j=function(){var e=Object(c.useState)(""),n=Object(d.a)(e,2),t=n[0],a=n[1];return Object(m.jsx)("div",{className:"blue-background",children:Object(m.jsxs)("div",{className:"login ",children:[Object(m.jsx)("h1",{children:"Login"}),Object(m.jsx)(l.a,{centered:!0,children:Object(m.jsx)(l.a.Row,{centered:!0,columns:"equal",children:Object(m.jsx)(l.a.Column,{children:Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),console.log("username",t),u.push("/room?username=".concat(t))},children:[Object(m.jsx)("input",{className:"username",onChange:function(e){return a(e.target.value)},placeholder:"Enter Name"}),Object(m.jsx)("button",{type:"submit",className:"btn",children:"Login"})]})})})})]})})},b=t(20),p=t(26),f=t.n(p),v=t(198),g=t(63),O=t(189),h=t(176),x=t(190),k=t(94),S=t(196),y=function(e){var n,t=e.room,c=e.active,a=e.onClick;return Object(m.jsxs)("div",{className:"room-item ".concat(c?"active":""),onClick:a,children:[Object(m.jsx)("div",{className:"room-item__header",children:t.name}),Object(m.jsx)("div",{className:"room-item__subheader",children:t.createdAt?new Date(1e3*t.createdAt).toUTCString():""}),Object(m.jsxs)("div",{className:"room-item__info",children:[(null===t||void 0===t||null===(n=t.users)||void 0===n?void 0:n.length)||0,"/5"]})]})},w=(t(167),function(e){var n=e.open,t=e.onCancel,a=e.onAdd,o=Object(c.useState)(""),r=Object(d.a)(o,2),i=r[0],s=r[1],u=Object(c.useState)(!1),l=Object(d.a)(u,2),j=l[0],b=l[1],p=function(){s(""),a(i),t()};return Object(m.jsx)(S.a,{size:"tiny",open:n,header:Object(m.jsx)(v.a,{style:{margin:0,padding:"25px 8px",textAlign:"center",backgroundColor:"rgba(0, 147, 208, 1)",color:"white"},children:"New Room"}),content:Object(m.jsxs)("div",{style:{padding:"12px 8px"},children:[Object(m.jsx)(v.a,{size:"small",children:"Name"}),Object(m.jsx)(x.a,{value:i,onChange:function(e){return s(e.target.value)},onFocus:function(){return b(!0)},onBlur:function(){return b(!1)},onKeyDown:function(e){"Enter"===e.key&&p()}}),Object(m.jsx)("div",{children:j&&!i?Object(m.jsx)(k.a,{basic:!0,color:"red",pointing:!0,content:"Invalid room name"}):""})]}),confirmButton:Object(m.jsx)(h.a,{primary:!0,content:"Add"}),cancelButton:Object(m.jsx)(h.a,{content:"Cancel"}),onCancel:function(){s(""),t()},onConfirm:p})}),E=Object(b.b)((function(e){var n=e.room;return{username:n.username,socket:n.socket,users:n.users,rooms:n.rooms}}),{})((function(e){var n=e.username,t=e.socket,o=e.users,r=e.rooms,i=Object(c.useState)(null),s=Object(d.a)(i,2),j=s[0],b=s[1],p=Object(c.useState)(!1),x=Object(d.a)(p,2),k=x[0],S=x[1];return Object(m.jsxs)(a.a.Fragment,{children:[Object(m.jsx)(w,{open:k,onCancel:function(){return S(!1)},onAdd:function(e){return function(e){e&&t.send(JSON.stringify({type:"add_room",data:e}))}(e)}}),Object(m.jsx)("div",{className:"rooms-grid",children:Object(m.jsxs)("div",{className:"rooms-container",children:[Object(m.jsxs)(v.a,{textAlign:"center",children:["Rooms",Object(m.jsxs)(v.a.Subheader,{style:{color:"green"},children:["Online User:",f.a.size(o)]})]}),j?Object(m.jsxs)("span",{id:"join_room",onClick:function(){u.push("/room/".concat(j,"?username=").concat(n))},children:["Join Room ",Object(m.jsx)(g.a,{name:"plus"})]}):"",Object(m.jsx)(O.a,{}),Object(m.jsx)(l.a,{centered:!0,className:"rooms-list",children:Object(m.jsx)(l.a.Row,{centered:!0,children:f.a.map(r,(function(e,n){return Object(m.jsx)(l.a.Column,{largeScreen:3,computer:4,tablet:5,mobile:6,children:Object(m.jsx)(y,{active:j===e.name,onClick:function(){return b(e.name)},room:e})},n)}))})}),Object(m.jsx)(O.a,{inverted:!0}),Object(m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(m.jsx)("div",{}),Object(m.jsx)(h.a,{secondary:!0,inverted:!0,onClick:function(){return S(!0)},children:"Create"})]})]})})]})}));t(170),t(171);navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});var C=[],T="https:"===window.location.protocol,D=!1;("undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(D=!0);var N=!1,I=!1,M=!1,_=!1;function R(e){D&&(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(C=[],navigator.enumerateDevices((function(n){n.forEach((function(e){var n,t={};for(var c in e)t[c]=e[c];"audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),C.forEach((function(e){e.id===t.id&&e.kind===t.kind&&(n=!0)})),n||(t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label?("videoinput"!==t.kind||_||(_=!0),"audioinput"!==t.kind||M||(M=!0)):(t.label="Please invoke getUserMedia once.",T||(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(N=!0),"audiooutput"===t.kind&&!0,"videoinput"===t.kind&&(I=!0),C.push(t))})),e&&e(I,N)}))):e&&e(I,N))}var A,U,L=t(193),P={},J=Object(b.b)((function(e){var n=e.media.stream;return{socket:e.room.socket,stream:n}}),{})((function(e){var n=e.socket,t=e.username,a=e.remoteUser,o=e.peerConnectionConfig,r=e.roomId,i=e.resetVideo,s=e.stream,u=Object(c.useState)(!1),l=Object(d.a)(u,2),j=l[0],b=l[1];console.log("stream #######",s),Object(c.useEffect)((function(){var e;(null===(e=P[a])||void 0===e?void 0:e.pc)&&P[a].sender&&s&&s.getTracks().forEach((function(e){return P[a].sender.replaceTrack(e)}))}),[null===s||void 0===s?void 0:s.id]),window.onbeforeunload=function(e){h()};var p=Object(c.useRef)();function f(e){var c=JSON.parse(e.data),o=c.from;switch(c.type){case"negotiate":c.room===r&&o===a&&(console.log("message ",c),O(),s?(P[a].pc&&(console.log("getting media ..."),(D?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(C=[],navigator.enumerateDevices((function(e){e.forEach((function(e){var n,t={};for(var c in e)t[c]=e[c];"audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),C.forEach((function(e){e.id===t.id&&e.kind===t.kind&&(n=!0)})),n||(t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label?("videoinput"!==t.kind||_||(_=!0),"audioinput"!==t.kind||M||(M=!0)):(t.label="Please invoke getUserMedia once.",T||(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(N=!0),"audiooutput"===t.kind&&!0,"videoinput"===t.kind&&(I=!0),C.push(t))}))})),Promise.resolve({hasWebcam:I,hasMicrophone:N})):Promise.resolve({hasWebcam:I,hasMicrophone:N})):Promise.resolve({hasWebcam:I,hasMicrophone:N})).then((function(e){e.hasMicrophone,e.hasWebcam,s&&!P[a].sender&&s.getTracks().forEach((function(e){return P[a].sender=P[a].pc.addTrack(e,s)}))}))),P[a].pc.onnegotiationneeded=x):x());break;case"reset":o===a&&c.data===t&&c.room===r&&(i(),n.removeEventListener("message",f));break;case"offer":console.log("message ",c),o===a&&function(e){O();var n=new RTCSessionDescription(e.sdp);if("stable"!==P[a].pc.signalingState)return;null!==n&&null!==e.sdp&&P[a].pc.setRemoteDescription(n).then((function(){s&&s.getTracks().forEach((function(e){return P[a].sender=P[a].pc.addTrack(e,s)}))})).then((function(){return P[a].pc.createAnswer()})).then((function(e){return P[a].pc.setLocalDescription(e)})).then((function(){y({from:t,type:"answer",room:r,sdp:P[a].pc.localDescription,data:a})})).catch((function(e){console.log("Error handleOfferMessage",e),v()}))}(c);break;case"answer":o===a&&P[a].pc&&function(e){P[a].pc.setRemoteDescription(e.sdp).catch((function(e){console.log("Error ",e),v()}))}(c);break;case"ice":o===a&&P[a].pc&&function(e){if(P[a].pc)if("stable"===P[a].pc.signalingState){var n,t=new RTCIceCandidate(e.candidate);t&&P[a].pc.localDescription&&(null===(n=P[a].pc.remoteDescription)||void 0===n?void 0:n.type)&&P[a].pc.addIceCandidate(t).catch((function(e){return console.log("ICE Error ",e)}))}else P[a].iceCandidate=e.candidate}(c);break;default:return}}function v(){y({from:t,type:"reset",room:r,data:a}),i(),n.removeEventListener("message",f)}function O(){P[a].pc&&h(),P[a].pc=new RTCPeerConnection(o),P[a].pc.oniceconnectionstatechange=function(){console.log("peer connection ice state ",P[a].pc.iceConnectionState,a)},P[a].pc.onsignalingstatechange=function(e){var n;switch(P[a].pc.signalingState){case"stable":if(!P[a].iceCandidate)return;var t=new RTCIceCandidate(P[a].iceCandidate);t&&P[a].pc.localDescription&&(null===(n=P[a].pc.remoteDescription)||void 0===n?void 0:n.type)&&P[a].pc.addIceCandidate(t).catch((function(e){return console.log("ICE Error ",e)})),console.log("Signaling State: Stable");break;case"closed":console.log("Signaling State: Closed")}},P[a].pc.onconnectionstatechange=function(e){switch(console.log("Peer connection ",P[a].pc.connectionState),P[a].pc.connectionState){case"connected":break;case"disconnected":case"failed":console.log("Peer connection ",P[a].pc.connectionState,"event##",e),v();break;case"closed":console.log("Peer connection closed")}},P[a].pc.addEventListener("icegatheringstatechange",(function(e){switch(P[a].pc.iceGatheringState){case"new":console.log("Ice New");break;case"gathering":console.log("Ice Gathering");break;case"complete":console.log("Ice  Complete"),p.current&&p.current.play().catch((function(e){return console.log("Failed to play video ",e)}))}})),P[a].pc.onicecandidate=k,P[a].pc.ontrack=S}function h(){var e;P[a].pc&&(console.log("disconnect all our event listeners"),P[a].pc.onicecandidate=null,P[a].pc.ontrack=null,P[a].pc.onnegotiationneeded=null,P[a].pc.oniceconnectionstatechange=null,P[a].pc.onsignalingstatechange=null,P[a].pc.onicegatheringstatechange=null,P[a].pc.onnotificationneeded=null,P[a].pc.onremovetrack=null,(p.current||(null===(e=p.current)||void 0===e?void 0:e.srcObject))&&(p.current.srcObject&&null!==p.current.srcObject.getTracks()&&p.current.srcObject.getTracks().forEach((function(e){return e.stop()})),p.current.pause()),P[a].videoSender=null,P[a].audioSender=null,P[a].sender=null,P[a].pc.close(),P[a].pc=null,P[a].iceCandidate&&(P[a].iceCandidate=null))}function x(){"stable"===P[a].pc.signalingState&&P[a].pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(e){return P[a].pc.setLocalDescription(e)})).then((function(){y({from:t,type:"offer",room:r,sdp:P[a].pc.localDescription,data:a})})).catch((function(e){console.log("Error ",e),v()}))}function k(e){e.candidate&&y({from:t,type:"ice",room:r,candidate:e.candidate,data:a})}Object(c.useEffect)((function(){return P[a]||(P[a]={}),P[a].pc&&(console.log("STOPPING CONNECTION ..."),h()),P[a].pc=null,n.addEventListener("message",f),P[a].pc&&"closed"!==P[a].pc.signalingState||y({from:t,type:"negotiate",room:r,data:a}),function(){console.log("REMOVING VIDEO ITEM"),n.removeEventListener("message",f),h()}}),[]);var S=function(e){p.current&&(console.log("track event",e),p.current.srcObject=e.streams[0],p.current.addEventListener("loadedmetadata",(function(){console.log("video on loaded meta data"),p.current&&p.current.play().catch((function(e){return console.log("Failed to play video ",e)}))})))};function y(e){var t=JSON.stringify(e);n.readyState===WebSocket.OPEN&&n.send(t)}return Object(m.jsxs)("div",{className:"video-grid__item",children:[Object(m.jsx)("h4",{children:a}),Object(m.jsxs)("div",{className:"".concat(j?"fullscreen":""),style:{position:"relative",objectFit:"cover",width:"100%",height:"100%"},children:[Object(m.jsx)("video",{ref:p}),Object(m.jsx)("div",{style:{width:"fit-content",height:"30px",color:"white",zIndex:"1",position:"absolute",top:"5px",right:"0px",background:"transparent"},children:Object(m.jsx)(L.a,{trigger:Object(m.jsx)(g.a,{onClick:function(){return b(!j)},name:"".concat(j?"compress":"expand"),link:!0,size:"large"}),content:"".concat(j?"Exit full screen":"Full screen")})}),Object(m.jsx)("div",{style:{width:"fit-content",height:"30px",color:"white",zIndex:"1",fontSize:"large",fontWeight:"bolder",position:"absolute",top:"5px",left:"10px",background:"transparent"},children:j?a:""})]})]})})),z=t(199),F=t(191),W=t(38),V=t.n(W),G=t(11),B=t(85),K=t(194),q=function(){var e=Object(B.a)(V.a.mark((function e(n){var t,c,a;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.video,c=n.audio,e.prev=1,a=!1,t&&(a={width:{exact:400},height:{exact:400},facingMode:"user"}),e.next=6,navigator.mediaDevices.getUserMedia({video:a,audio:c});case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(1),console.log(e.t0,t,c),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(n){return e.apply(this,arguments)}}(),X=function(){var e=Object(B.a)(V.a.mark((function e(n){var t,c,a;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.video,c=n.audio,e.prev=1,a=!1,t&&(a={width:{exact:400},height:{exact:400},facingMode:"user"}),e.next=6,navigator.mediaDevices.getDisplayMedia({video:a,audio:c});case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(n){return e.apply(this,arguments)}}(),H="SET USERNAME",Y="SET SOCKET",Q="SET ROOMS",Z="SET USERS",$="ADD MESSAGE",ee="CLEAR MESSAGES",ne="SET CAM STREAM",te="SET SCREEN STREAM",ce="SET MEDIA CONSTRAINTS",ae="SET MEDIA SOURCE",oe="EXIT",re=function(e){return{type:$,payload:e}},ie=Object(b.b)((function(e){var n=e.media,t=n.camStream,c=n.screenStream,a=n.mediaConstraints,o=n.source,r=e.room;return{socket:r.socket,username:r.username,camStream:t,screenStream:c,mediaConstraints:a,source:o}}),{addMessage:re,setCamStream:function(e){return{type:ne,payload:e}},setScreenStream:function(e){return{type:te,payload:e}},setMediaConstraints:function(e){return{type:ce,payload:e}},setMediaSource:function(e){return{type:ae,payload:e}}})((function(e){var n=e.source,t=e.setReadyToJoin,a=e.mediaConstraints,o=e.setCamStream,r=e.setScreenStream,i=e.setMediaConstraints,s=e.setMediaSource,u=Object(c.useRef)();function d(e){var n=e.video,t=e.audio;R((function(e,c){i({video:e&&n,audio:c&&t})}))}function l(e){return j.apply(this,arguments)}function j(){return(j=Object(B.a)(V.a.mark((function e(n){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return o(null),e.abrupt("return");case 3:if(!u.current){e.next=10;break}return o(n),u.current.pause(),u.current.srcObject=n,u.current.muted=!0,e.next=10,u.current.play();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return p.apply(this,arguments)}function p(){return(p=Object(B.a)(V.a.mark((function e(n){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return o(null),e.abrupt("return");case 3:if(!u.current){e.next=10;break}return r(n),u.current.pause(),u.current.srcObject=n,u.current.muted=!0,e.next=10,u.current.play();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(c.useEffect)((function(){R((function(e,n){i({video:e,audio:n})}))}),[]),Object(c.useEffect)((function(){var e=a.video,c=a.audio;(e||c)&&function(){var e=a.video,c=a.audio;R((function(a,o){var r={video:a&&e,audio:o&&c};r.video||r.audio?"camera"===n?q(r).then(l).finally((function(){return t(!0)})):X(r).then(b).finally((function(){return t(!0)})):t(!0)}))}()}),[a,n]);return Object(m.jsxs)("div",{className:"video-grid__item",children:[Object(m.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"baseline",gap:"0",justifyContent:"space-between"},children:[Object(m.jsx)("div",{}),Object(m.jsx)("h3",{style:{margin:"0 0 0px 0px",color:"rgba(0, 147, 208, 1)"},children:"You"}),Object(m.jsxs)("span",{children:[Object(m.jsx)(L.a,{trigger:a.audio?Object(m.jsx)(g.a,{style:{fontSize:"16px",textAlign:"center"},name:"unmute",link:!0,onClick:function(){return d(Object(G.a)(Object(G.a)({},a),{},{audio:!1}))}}):Object(m.jsx)(g.a,{style:{fontSize:"16px",textAlign:"center"},name:"mute",link:!0,onClick:function(){return d(Object(G.a)(Object(G.a)({},a),{},{audio:!0}))}}),content:"audio"}),Object(m.jsx)(L.a,{trigger:a.video?Object(m.jsx)(g.a,{name:"video camera",link:!0,onClick:function(){return d(Object(G.a)(Object(G.a)({},a),{},{video:!1}))}}):Object(m.jsxs)(g.a.Group,{style:{fontSize:"16px"},onClick:function(){return d(Object(G.a)(Object(G.a)({},a),{},{video:!0}))},children:[Object(m.jsx)(g.a,{name:"video camera",link:!0}),Object(m.jsx)(g.a,{corner:!0,name:"cancel",color:"red"})]}),content:"video"}),Object(m.jsx)(K.a,{floating:!0,icon:{name:"ellipsis vertical"},children:Object(m.jsx)(K.a.Menu,{children:Object(m.jsxs)(K.a.Item,{disabled:!navigator.mediaDevices.getDisplayMedia,onClick:function(){s("camera"===n?"screen":"camera")},children:["Share  ","camera"===n?"Screen":"Camera"," Video"]})})})]})]}),Object(m.jsx)("video",{ref:u})]})})),se={iceServers:[]},ue=function(e){var n=e.username,t=e.remoteUser,o=e.roomId,r=Object(c.useState)(!1),i=Object(d.a)(r,2),s=i[0],u=i[1];return Object(c.useEffect)((function(){s&&setTimeout((function(){u(!1)}),5e3)}),[s]),s?Object(m.jsx)(z.a.Dimmable,{className:"video-grid__item",dimmed:!0,children:Object(m.jsx)(F.a,{active:s,style:{border:0}})}):Object(m.jsx)(a.a.Fragment,{children:Object(m.jsx)(J,{remoteUser:t,username:n,peerConnectionConfig:se,roomId:o,resetVideo:function(){return u(!0)}},t)})},de=Object(b.b)((function(e,n){var t=n.roomId,c=e.room,a=c.username,o=c.rooms,r=c.socket;return{username:a,room:o[t],socket:r,stream:e.media.stream}}),{addMessage:re})((function(e){var n=e.socket,t=e.addMessage,a=e.username,o=e.room,r=e.roomId,i=Object(c.useState)(!1),s=Object(d.a)(i,2),u=s[0],l=s[1];return Object(c.useEffect)((function(){u&&(n.send(JSON.stringify({type:"join_room",from:a,data:r})),n.addEventListener("message",(function(e){var n=JSON.parse(e.data);"text"===n.type&&t({from:n.from,text:n.data})})))}),[u]),Object(m.jsxs)("div",{className:"video-grid",children:[Object(m.jsx)(ie,{roomId:r,setReadyToJoin:l}),f.a.chain(null===o||void 0===o?void 0:o.users).filter((function(e){return e!==a})).map((function(e){return u?Object(m.jsx)(ue,{roomId:r,username:a,remoteUser:e},e):Object(m.jsx)("div",{children:"Loading..."},e)})).value()]})})),le=function(e){var n=e.onSend,t=Object(c.useState)(""),a=Object(d.a)(t,2),o=a[0],r=a[1],i=function(){n(o),r("")};return Object(m.jsxs)("div",{className:"chat__inputs",children:[Object(m.jsx)("input",{value:o,onKeyDown:function(e){"Enter"===e.key&&i()},onChange:function(e){return r(e.target.value)}}),Object(m.jsx)("button",{onClick:i,children:"Send"})]})},me=Object(b.b)((function(e,n){var t=n.roomId,c=e.room;return{username:c.username,socket:c.socket,messages:c.messages,room:c.rooms[t]}}),{})((function(e){var n=e.username,t=e.socket,c=e.messages,o=e.room,r=e.roomId;return Object(m.jsx)("div",{children:Object(m.jsx)(l.a,{id:"room",stackable:!0,children:Object(m.jsxs)(l.a.Row,{style:{padding:"8px 0 0 0"},children:[Object(m.jsx)(l.a.Column,{largeScreen:11,children:Object(m.jsx)("div",{style:{margin:"50px 0 0 10px"},children:Object(m.jsx)(de,{roomId:r})})}),Object(m.jsx)(l.a.Column,{largeScreen:5,children:Object(m.jsxs)("div",{className:"chat",children:[Object(m.jsx)("div",{className:"chat__clients",children:Object(m.jsxs)(a.a.Fragment,{children:[Object(m.jsx)(v.a,{textAlign:"center",children:"Users"}),Object(m.jsx)(O.a,{fitted:!0}),f.a.map(null===o||void 0===o?void 0:o.users,(function(e,n){return Object(m.jsxs)(a.a.Fragment,{children:[Object(m.jsx)("div",{style:{fontWeight:"bold",fontSize:"12px",padding:"6px 6px"},children:e}),Object(m.jsx)(O.a,{fitted:!0,style:{backgroundColor:"rgba(208, 173, 0, 0.1)"}})]},n)}))]})}),Object(m.jsx)("div",{className:"chat__messages",children:f.a.map(c,(function(e,t){return Object(m.jsx)(a.a.Fragment,{children:(c=e,Object(m.jsx)("div",{children:c.from!==n?Object(m.jsxs)("div",{style:{color:"".concat(o||"black")},className:" message",children:[Object(m.jsxs)("b",{children:[c.from,": "]}),Object(m.jsx)("div",{children:c.text})]}):Object(m.jsxs)("div",{style:{color:"".concat(o||"black"),display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[Object(m.jsx)("div",{}),Object(m.jsx)("div",{className:"blue message",children:c.text})]})}))},t);var c,o}))}),Object(m.jsx)(le,{onSend:function(e){return t.send(JSON.stringify({type:"text",from:n,data:e,room:r}))}})]})})]})})})})),je=t(195);function be(e){e&&(e.onicecandidate=null,e.ontrack=null,e.onnegotiationneeded=null,e.oniceconnectionstatechange=null,e.onsignalingstatechange=null,e.onicegatheringstatechange=null,e.onnotificationneeded=null,e.onremovetrack=null,e.close(),e=null)}function pe(){R((function(e,n){(n||e)&&navigator.mediaDevices.getUserMedia({video:e,audio:n}).then((function(e){e.getTracks().forEach((function(e){e.stop()}))})).catch((function(e){console.log(e)}))}))}var fe=Object(b.b)((function(e){var n=e.room;return{username:n.username,socket:n.socket}}),{setUsername:function(e){return{type:H,payload:e}},setSocket:function(e){return{type:Y,payload:e}},setUsers:function(e){return{type:Z,payload:e}},setRooms:function(e){return{type:Q,payload:e}},exit:function(){return{type:oe}}})((function(e){var n=e.setUsername,t=e.setSocket,o=e.setUsers,r=e.setRooms,s=e.exit,l=e.socket,j=Object(c.useState)({type:"",message:""}),b=Object(d.a)(j,2),p=b[0],g=b[1],O=Object(i.e)().id;window.onbeforeunload=function(e){l&&l.close()};var x=new URLSearchParams(u.location.search).get("username");Object(c.useEffect)((function(){x&&(n(x),console.log("creating socket connection...",l),l||function(){var e;e="http:"===window.location.protocol?new WebSocket("ws://localhost:8080/signal"):new WebSocket("wss://".concat(window.location.host,"/signal"));e.onopen=function(){U=setInterval((function(){return function(e){e.send(JSON.stringify({type:"__ping__",from:x})),A=setTimeout((function(){clearInterval(U)}),5e3)}(e)}),3e4),console.log("Socket connection successful"),e.send(JSON.stringify({type:"join",from:x})),t(e)},e.onclose=function(){u.push("/"),clearInterval(U),clearTimeout(A)},e.onerror=function(e){console.log("Socket connection error ",e)}}())}),[]),l&&(l.onmessage=function(e){var n=JSON.parse(e.data);switch(n.type){case"__pong__":clearTimeout(A);break;case"state":console.log("message ",n),o(n.users),r(n.rooms);break;case"error":console.log("Error message ",n),g({type:"join",message:n.data});break;case"room_error":console.log("Error message ",n),g({type:"room",message:n.data})}});if(!l)return Object(m.jsx)("div",{children:"Loading..."});return Object(m.jsxs)(a.a.Fragment,{children:[Object(m.jsx)(S.a,{size:"tiny",open:!!p.message,header:Object(m.jsx)(v.a,{style:{margin:0,padding:"25px 8px",textAlign:"center",backgroundColor:"rgba(253,0,0, 0.8)",color:"white"},children:"Error"}),content:p.message,style:{fontWeight:"bolder"},confirmButton:Object(m.jsx)(a.a.Fragment,{}),cancelButton:Object(m.jsx)(h.a,{content:"Cancel"}),onCancel:function(){"join"===p.type&&(console.log("on close error modal"),l.close(),s(),u.push("/")),"room"===p.type&&u.push("/room?username=".concat(x)),g({type:"",message:""})}}),Object(m.jsxs)(je.a,{fixed:"top",children:[Object(m.jsx)(je.a.Item,{name:O?"Leave":"Exit",as:"a",header:!0,onClick:function(){return O?(f.a.forEach(P,(function(e,n){be(e.pc)})),pe(),u.push("/room?username=".concat(x)),void l.send(JSON.stringify({type:"leave_room",from:x,room:O}))):(f.a.forEach(P,(function(e,n){be(e.pc)})),pe(),l.close(),s(),void u.push("/"))}}),Object(m.jsx)(je.a.Item,{name:x,position:"right",header:!0})]}),Object(m.jsx)("div",{children:O?Object(m.jsx)(me,{roomId:O}):Object(m.jsx)(E,{})})]})})),ve=function e(){return Object(m.jsx)(i.c,{history:u,children:Object(m.jsxs)(i.d,{children:[Object(m.jsx)(i.b,{exact:!0,path:"/",children:Object(m.jsx)(i.a,{to:"/login"})}),Object(m.jsx)(i.b,{exact:!0,path:"/login",component:j}),Object(m.jsx)(i.b,{exact:!0,path:"/room",component:fe}),Object(m.jsx)(i.b,{exact:!0,path:"/room/:id",component:fe}),Object(m.jsx)(e,{})]})})};var ge=function(){return Object(m.jsx)(ve,{})},Oe=(t(174),t(93)),he=t(145),xe={username:"",socket:null,rooms:{},users:{},messages:[]},ke={camStream:null,screenStream:null,stream:null,mediaConstraints:{video:!0,audio:!0},source:"camera"},Se=Object(Oe.a)({room:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xe,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case H:return Object(G.a)(Object(G.a)({},e),{},{username:n.payload});case Y:return Object(G.a)(Object(G.a)({},e),{},{socket:n.payload});case Q:return Object(G.a)(Object(G.a)({},e),{},{rooms:f.a.mapKeys(n.payload,"name")});case Z:return Object(G.a)(Object(G.a)({},e),{},{users:n.payload});case $:return Object(G.a)(Object(G.a)({},e),{},{messages:[].concat(Object(he.a)(e.messages),[n.payload])});case ee:return Object(G.a)(Object(G.a)({},e),{},{messages:[]});default:return e}},media:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ke,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case ne:var t=n.payload;return t?Object(G.a)(Object(G.a)({},e),{},{camStream:t,stream:t}):e;case te:var c=n.payload;return c?Object(G.a)(Object(G.a)({},e),{},{screenStream:c,stream:c}):e;case ce:var a=n.payload,o=a.video,r=a.audio,i=e.stream;return i&&(!1===o&&i.getVideoTracks().forEach((function(e){return e.stop()})),!1===r&&i.getAudioTracks().forEach((function(e){return e.stop()}))),Object(G.a)(Object(G.a)({},e),{},{mediaConstraints:n.payload,stream:i});case ae:var s=n.payload;return Object(G.a)(Object(G.a)({},e),{},{source:s});default:return e}}}),ye=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Oe.b,we=Object(Oe.c)((function(e,n){return n.type===oe?Se(void 0,n):Se(e,n)}),ye());r.a.render(Object(m.jsx)(b.a,{store:we,children:Object(m.jsx)(ge,{})}),document.getElementById("root"))}},[[175,1,2]]]);
//# sourceMappingURL=main.d0d9f76d.chunk.js.map