{"version":3,"sources":["history.js","components/Login.js","components/RoomItem.js","components/RoomList.js","utility/checkDeviceSupport.js","components/RoomPage.js","components/VideoItem.js","utility/getMediaDevices.js","actions/types.js","actions/room.js","components/LocalVideo.js","actions/media.js","components/VideoList.js","components/Room.js","Routes.js","App.js","reducers/room.js","reducers/media.js","reducers/index.js","store.js","index.js"],"names":["createBrowserHistory","Login","useState","username","setUsername","className","Grid","centered","Row","columns","Column","onSubmit","e","preventDefault","console","log","history","push","onChange","target","value","placeholder","type","RoomItem","room","active","onClick","name","createdAt","Date","toUTCString","users","length","RoomForm","open","onCancel","onAdd","setValue","touched","setTouched","Confirm","size","header","Header","style","margin","padding","textAlign","backgroundColor","color","content","Input","onFocus","onBlur","onKeyDown","key","Label","basic","pointing","confirmButton","Button","primary","cancelButton","onConfirm","connect","state","socket","rooms","activeItem","setActiveItem","setOpen","Fragment","send","JSON","stringify","data","onAddRoom","Subheader","_","id","Icon","Divider","map","r","i","largeScreen","computer","tablet","mobile","inverted","display","justifyContent","secondary","navigator","mediaDevices","enumerateDevices","callback","then","MediaDevices","isHTTPs","window","location","protocol","canEnumerate","MediaStreamTrack","hasMicrophone","hasWebcam","isMicrophoneAlreadyCaptured","isWebcamAlreadyCaptured","checkDeviceSupport","getSources","bind","devices","forEach","_device","skip","device","d","kind","deviceId","label","timeout","pingInterval","peers","stream","media","remoteUser","peerConnectionConfig","roomId","resetVideo","fullscreen","setFullscreen","useEffect","pc","sender","getTracks","track","replaceTrack","onbeforeunload","stop","remoteVideoRef","useRef","messageHandler","msg","message","parse","from","createPeerConnection","Promise","resolve","addTrack","onnegotiationneeded","handleNegotiationNeededEvent","removeEventListener","desc","RTCSessionDescription","sdp","signalingState","setRemoteDescription","createAnswer","answer","setLocalDescription","sendToServer","localDescription","catch","resetConnection","handleOfferMessage","handleAnswerMessage","candidate","RTCIceCandidate","remoteDescription","addIceCandidate","iceCandidate","handleNewICECandidateMessage","RTCPeerConnection","oniceconnectionstatechange","iceConnectionState","onsignalingstatechange","event","onconnectionstatechange","connectionState","addEventListener","ev","iceGatheringState","current","play","onicecandidate","handleICECandidateEvent","ontrack","handleTrackEvent","onicegatheringstatechange","onnotificationneeded","onremovetrack","srcObject","pause","videoSender","audioSender","close","createOffer","offerToReceiveAudio","offerToReceiveVideo","offer","streams","msgJSON","readyState","WebSocket","OPEN","position","objectFit","width","height","ref","zIndex","top","right","background","Popup","trigger","link","fontSize","fontWeight","left","getUserMedia","a","video","audio","vi","exact","facingMode","getDisplayMedia","SET_USERNAME","SET_SOCKET","SET_ROOMS","SET_USERS","ADD_MESSAGE","CLEAR_MESSAGES","SET_CAM_STREAM","SET_SCREEN_STREAM","SET_MEDIA_CONSTRAINTS","SET_MEDIA_SOURCE","EXIT","addMessage","payload","camStream","screenStream","mediaConstraints","source","setCamStream","setScreenStream","setMediaConstraints","constraints","setMediaSource","setReadyToJoin","localVideoRef","changeConstraints","getLocalMediaStream","mediaStream","muted","getScreenMediaStream","finally","getMedia","flexDirection","alignItems","gap","Group","corner","Dropdown","floating","icon","Menu","Item","disabled","PeerVideo","loading","setLoading","setTimeout","Dimmer","Dimmable","dimmed","Loader","border","props","readyToJoin","text","chain","filter","u","ChatInput","onSend","onSendHandler","messages","stackable","fitted","m","stopConnection","stopMediaDevices","setSocket","setUsers","clients","setRooms","exit","error","setError","useParams","URLSearchParams","search","get","so","host","onopen","setInterval","clearInterval","ping","onclose","clearTimeout","onerror","createSocketConnection","onmessage","fixed","as","peer","Routes","path","to","component","RoomPage","App","INITIAL_STATE","combineReducers","action","mapKeys","getVideoTracks","getAudioTracks","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","reducers","undefined","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.d0d9f76d.chunk.js","sourcesContent":["import {createBrowserHistory} from 'history';\n\n\nexport default createBrowserHistory();","import React, { useState} from \"react\";\nimport { Grid} from \"semantic-ui-react\";\n\n\nimport './Login.css';\nimport history from \"../history\";\n\nconst Login = () => {\n    const [username, setUsername] = useState('');\n    // const [password, setPassword] = useState('');\n\n\n\n\n\n\n    const onSubmit = (e) => {\n        e.preventDefault();\n        console.log('username', username)\n        // if(password !== 'nopassword123456') return ;\n        history.push(`/room?username=${username}`);\n    }\n\n    return (\n        <div className={'blue-background'}>\n            <div className={'login '}>\n                <h1>Login</h1>\n                <Grid centered>\n                    <Grid.Row centered columns={\"equal\"}>\n                        <Grid.Column>\n                            <form onSubmit={onSubmit}>\n                                <input className=\"username\" onChange={(e) => setUsername(e.target.value)} placeholder=\"Enter Name\" />\n                                {/*<input className=\"username\"  type={\"password\"} onChange={(e) => setPassword(e.target.value)}  placeholder={\"Password\"}/>*/}\n                                <button  type={\"submit\"}  className=\"btn\">Login</button>\n                            </form>\n                        </Grid.Column>\n                    </Grid.Row>\n                </Grid>\n            </div>\n        </div>\n    );\n}\n\nexport default Login;","import React from \"react\";\n\n\n\n\nconst RoomItem = ({room, active, onClick}) => {\n\n    return (\n        <div className={`room-item ${active ? 'active' : ''}`} onClick={onClick}>\n            <div className={'room-item__header'}>{room.name}</div>\n            <div className={'room-item__subheader'}>{room.createdAt ? new Date(room.createdAt * 1000).toUTCString() : ''}</div>\n            <div className={'room-item__info'}>\n                {room?.users?.length || 0}/5\n            </div>\n        </div>\n    );\n}\n\nexport default RoomItem;\n\n","import React, {useState} from \"react\";\nimport {connect} from \"react-redux\";\nimport _ from 'lodash';\nimport {Button, Confirm, Divider, Grid, Header, Icon, Input, Label} from \"semantic-ui-react\";\nimport RoomItem from \"./RoomItem\";\n\nimport './RoomList.css'\nimport history from \"../history\";\n\n\n\n\nconst RoomList = ({username , socket, users, rooms}) => {\n    const [activeItem, setActiveItem] = useState(null);\n    const [open, setOpen] = useState(false);\n\n\n    const onAddRoom = (name) => {\n        if(!name) return ;\n        socket.send(JSON.stringify({type: 'add_room', data: name, }))\n    }\n\n    const onJoinRoom = () => {\n        history.push(`/room/${activeItem}?username=${username}`)\n    }\n    return (\n        <React.Fragment>\n           <RoomForm open={open} onCancel={() => setOpen(false)} onAdd={(name) => onAddRoom(name)} />\n            <div className={'rooms-grid'}   >\n                <div   className={'rooms-container'} >\n                    <Header textAlign={\"center\"}>Rooms\n                        <Header.Subheader style={{color: 'green'}}>Online User:{_.size(users)}</Header.Subheader>\n                    </Header>\n                    {activeItem ? <span id={'join_room'} onClick={() => onJoinRoom() } >Join Room <Icon name={'plus'} /></span> : ''}\n                    <Divider />\n                    <Grid    centered    className={'rooms-list'} >\n                        <Grid.Row centered >\n                            {_.map(rooms, (r , i) => {\n                                return (\n                                    <Grid.Column key={i} largeScreen={3} computer={4} tablet={5} mobile={6} >\n                                        <RoomItem active={activeItem === r.name} onClick={() => setActiveItem(r.name)} room={r} />\n                                    </Grid.Column>\n                                );\n                            })}\n\n                        </Grid.Row>\n                    </Grid>\n\n                    <Divider inverted />\n                    <div style={{display: 'flex', justifyContent: \"space-between\"}}>\n                        <div/>\n                        <Button secondary inverted onClick={() => setOpen(true)}>Create</Button>\n                    </div>\n\n                </div>\n            </div>\n        </React.Fragment>\n\n    );\n}\n\n\nconst RoomForm = ({open , onCancel , onAdd}) => {\n    const [value, setValue] = useState('');\n    const [touched, setTouched] = useState(false);\n\n    const onSubmit = () => {\n        setValue('')\n        onAdd(value);\n        onCancel();\n    }\n\n    const renderRoomForm =() => {\n        return (\n            <div style={{padding: '12px 8px'}}>\n                <Header size={\"small\"}>Name</Header>\n                <Input value={value}  onChange={(e) => setValue(e.target.value)}\n                       onFocus={() => setTouched(true)} onBlur={() => setTouched(false)}  onKeyDown={(e) =>{\n                    if(e.key === 'Enter') {\n                        onSubmit()\n                    }\n                } }  />\n               <div>\n                   {touched && !value ? <Label basic color={'red'}  pointing content={'Invalid room name'} /> : '' }\n               </div>\n\n            </div>\n        );\n    }\n    return (\n        <Confirm\n            size={\"tiny\"}\n            open={open}\n            header={<Header style={{margin: 0 ,  padding: '25px 8px', textAlign: 'center'\n                , backgroundColor: 'rgba(0, 147, 208, 1)', color: 'white'}}>New Room</Header>}\n            content={renderRoomForm()}\n            confirmButton={<Button primary content={'Add'} /> }\n            cancelButton={<Button   content={'Cancel'} /> }\n            onCancel={() => {\n                setValue('')\n                onCancel()\n            }}\n            onConfirm={onSubmit}\n        />\n    );\n}\n\nconst mapStateToProps = (state) => {\n    const {username , socket, users, rooms} = state.room;\n    return {username , socket, users, rooms};\n}\n\n\nexport default connect(mapStateToProps, {})(RoomList);","if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n    // Firefox 38+ seems having support of enumerateDevicesx\n    navigator.enumerateDevices = function(callback) {\n        navigator.mediaDevices.enumerateDevices().then(callback);\n    };\n}\n\nvar MediaDevices = [];\nvar isHTTPs = window.location.protocol === 'https:';\nvar canEnumerate = false;\n\nif (typeof MediaStreamTrack !== 'undefined' && 'getSources' in MediaStreamTrack) {\n    canEnumerate = true;\n} else if (navigator.mediaDevices && !!navigator.mediaDevices.enumerateDevices) {\n    canEnumerate = true;\n}\n\nvar hasMicrophone = false;\nvar hasSpeakers = false;\nvar hasWebcam = false;\n\nvar isMicrophoneAlreadyCaptured = false;\nvar isWebcamAlreadyCaptured = false;\n\nexport  function checkDeviceSupport(callback) {\n    if (!canEnumerate) {\n        return;\n    }\n\n    if (!navigator.enumerateDevices && window.MediaStreamTrack && window.MediaStreamTrack.getSources) {\n        navigator.enumerateDevices = window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack);\n    }\n\n    if (!navigator.enumerateDevices && navigator.enumerateDevices) {\n        navigator.enumerateDevices = navigator.enumerateDevices.bind(navigator);\n    }\n\n    if (!navigator.enumerateDevices) {\n        if (callback) {\n            callback(hasWebcam, hasMicrophone);\n        }\n        return;\n    }\n\n    MediaDevices = [];\n    navigator.enumerateDevices(function(devices) {\n        devices.forEach(function(_device) {\n            var device = {};\n            for (var d in _device) {\n                device[d] = _device[d];\n            }\n\n            if (device.kind === 'audio') {\n                device.kind = 'audioinput';\n            }\n\n            if (device.kind === 'video') {\n                device.kind = 'videoinput';\n            }\n\n            var skip;\n            MediaDevices.forEach(function(d) {\n                if (d.id === device.id && d.kind === device.kind) {\n                    skip = true;\n                }\n            });\n\n            if (skip) {\n                return;\n            }\n\n            if (!device.deviceId) {\n                device.deviceId = device.id;\n            }\n\n            if (!device.id) {\n                device.id = device.deviceId;\n            }\n\n            if (!device.label) {\n                device.label = 'Please invoke getUserMedia once.';\n                if (!isHTTPs) {\n                    device.label = 'HTTPs is required to get label of this ' + device.kind + ' device.';\n                }\n            } else {\n                if (device.kind === 'videoinput' && !isWebcamAlreadyCaptured) {\n                    isWebcamAlreadyCaptured = true;\n                }\n\n                if (device.kind === 'audioinput' && !isMicrophoneAlreadyCaptured) {\n                    isMicrophoneAlreadyCaptured = true;\n                }\n            }\n\n            if (device.kind === 'audioinput') {\n                hasMicrophone = true;\n            }\n\n            if (device.kind === 'audiooutput') {\n                hasSpeakers = true;\n            }\n\n            if (device.kind === 'videoinput') {\n                hasWebcam = true;\n            }\n\n            // there is no 'videoouput' in the spec.\n\n            MediaDevices.push(device);\n        });\n\n        if (callback) {\n            callback(hasWebcam, hasMicrophone);\n        }\n    });\n}\n\n\nexport  function getSupportedDevices() {\n\n    if (!canEnumerate) {\n        return Promise.resolve({hasWebcam, hasMicrophone});\n    }\n\n    if (!navigator.enumerateDevices && window.MediaStreamTrack && window.MediaStreamTrack.getSources) {\n        navigator.enumerateDevices = window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack);\n    }\n\n    if (!navigator.enumerateDevices && navigator.enumerateDevices) {\n        navigator.enumerateDevices = navigator.enumerateDevices.bind(navigator);\n    }\n\n    if (!navigator.enumerateDevices) {\n            return Promise.resolve({hasWebcam, hasMicrophone});\n    }\n\n    MediaDevices = [];\n    navigator.enumerateDevices(function(devices) {\n        devices.forEach(function(_device) {\n            var device = {};\n            for (var d in _device) {\n                device[d] = _device[d];\n            }\n\n            if (device.kind === 'audio') {\n                device.kind = 'audioinput';\n            }\n\n            if (device.kind === 'video') {\n                device.kind = 'videoinput';\n            }\n\n            var skip;\n            MediaDevices.forEach(function(d) {\n                if (d.id === device.id && d.kind === device.kind) {\n                    skip = true;\n                }\n            });\n\n            if (skip) {\n                // return Promise.resolve({hasWebcam, hasMicrophone});\n                return;\n            }\n\n            if (!device.deviceId) {\n                device.deviceId = device.id;\n            }\n\n            if (!device.id) {\n                device.id = device.deviceId;\n            }\n\n            if (!device.label) {\n                device.label = 'Please invoke getUserMedia once.';\n                if (!isHTTPs) {\n                    device.label = 'HTTPs is required to get label of this ' + device.kind + ' device.';\n                }\n            } else {\n                if (device.kind === 'videoinput' && !isWebcamAlreadyCaptured) {\n                    isWebcamAlreadyCaptured = true;\n                }\n\n                if (device.kind === 'audioinput' && !isMicrophoneAlreadyCaptured) {\n                    isMicrophoneAlreadyCaptured = true;\n                }\n            }\n\n            if (device.kind === 'audioinput') {\n                hasMicrophone = true;\n            }\n\n            if (device.kind === 'audiooutput') {\n                hasSpeakers = true;\n            }\n\n            if (device.kind === 'videoinput') {\n                hasWebcam = true;\n            }\n\n            // there is no 'videoouput' in the spec.\n\n            MediaDevices.push(device);\n        });\n\n    });\n    return Promise.resolve({hasWebcam, hasMicrophone});\n\n}","import React, {useState, useEffect} from \"react\";\nimport {connect} from \"react-redux\";\nimport  {useParams} from 'react-router-dom';\nimport _ from 'lodash';\nimport RoomList from \"./RoomList\";\nimport Room from \"./Room\";\nimport history from \"../history\";\nimport {Button, Confirm, Header, Menu} from \"semantic-ui-react\";\nimport {peers} from \"./VideoItem\";\nimport {checkDeviceSupport} from \"../utility/checkDeviceSupport\";\n\n\nimport {setUsername, setSocket, setUsers, setRooms, exit} from '../actions/room';\n\n\n\n\nvar timeout;\nvar pingInterval;\n\nconst RoomPage = ({setUsername, setSocket, setUsers, setRooms, exit, socket}) => {\n    const [error, setError] = useState({type: '', message: ''});\n    const {id} = useParams();  //roomId\n\n    window.onbeforeunload = function (e) {\n        if(socket) socket.close();\n    };\n\n\n\n\n\n    const username = new URLSearchParams(history.location.search).get('username');\n    useEffect(() => {\n        if(username) {\n            setUsername(username);\n            console.log('creating socket connection...', socket);\n            // dispatch({type: 'SET_USERNAME', payload: username});\n            if(!socket ) {\n                createSocketConnection();\n\n            }\n        }\n\n    // } ,  [socket]);\n    } ,  []);\n\n\n    function createSocketConnection() {\n        let so;\n        if(window.location.protocol === 'http:')\n            so= new WebSocket(`ws://localhost:8080/signal` );\n        // so= new WebSocket(`ws://${window.location.host}/signal` );\n        else\n            so = new WebSocket(`wss://${window.location.host}/signal` );\n\n\n\n        so.onopen = function () {\n            pingInterval = setInterval(() => ping(so), 30000);\n\n            console.log('Socket connection successful')\n            so.send(JSON.stringify({type: 'join', from: username, }));\n            // dispatch({type: 'SET_SOCKET', payload: so});\n            setSocket(so);\n        }\n        so.onclose = function() {\n            history.push('/');\n            clearInterval(pingInterval);\n            clearTimeout(timeout);\n        }\n        so.onerror = function (event) {\n            console.log('Socket connection error ', event);\n        }\n\n    }\n    function ping(so) {\n        so.send(JSON.stringify({type: '__ping__', from: username }));\n        timeout = setTimeout(function () {\n            clearInterval(pingInterval);\n            //connection closed\n        }, 5000);\n    }\n\n    function pong() {\n        clearTimeout(timeout)\n    }\n\n    if(socket) {\n        socket.onmessage = function (msg) {\n            const message = JSON.parse(msg.data);\n            switch (message.type) {\n                case '__pong__': {\n                    pong();\n                    break;\n                }\n                case 'state':{\n                    console.log('message ' ,message)\n                    setUsers(message.users);\n                    setRooms(message.rooms);\n                    break;\n                }\n                case 'error': {\n                    console.log('Error message ', message)\n                    setError({type: 'join', message: message.data  });\n                    break;\n                }\n                case 'room_error': {\n                    console.log('Error message ', message)\n                    setError({type: 'room', message: message.data  });\n\n                }\n            }\n\n\n        }\n\n    }\n\n    const onExit = () => {\n        _.forEach(peers , (peer, i) => {\n            stopConnection(peer.pc);\n        });\n        stopMediaDevices();\n        socket.close();\n        exit()\n        history.push('/')\n    }\n    const onLeave = () => {\n        _.forEach(peers , (peer, i) => {\n            stopConnection(peer.pc);\n        });\n        stopMediaDevices();\n        history.push(`/room?username=${username}`);\n        socket.send(JSON.stringify({type: 'leave_room', from: username, room: id }));\n    }\n\n\n    if(!socket ) return <div>Loading...</div>\n\n\n    const onCancel = () => {\n        if(error.type === 'join') {\n            console.log('on close error modal')\n            socket.close();\n            exit();\n            history.push('/');\n\n        }\n        if(error.type === 'room') {\n            history.push(`/room?username=${username}`);\n        }\n        setError({type:  '', message: ''});\n\n    };\n    return (\n        <React.Fragment>\n            <Confirm\n                size={\"tiny\"}\n                open={!!error.message}\n                header={<Header style={{margin: 0 ,  padding: '25px 8px', textAlign: 'center'\n                    , backgroundColor: 'rgba(253,0,0, 0.8)', color: 'white'}}>Error</Header>}\n                content={error.message}\n                style={{fontWeight: 'bolder'}}\n                confirmButton={<React.Fragment /> }\n\n                cancelButton={<Button    content={'Cancel'} /> }\n                onCancel={onCancel}\n\n            />\n            <Menu fixed={\"top\"} >\n                <Menu.Item name={id ? 'Leave' : 'Exit'}  as={'a'} header onClick={() => id ? onLeave() : onExit()}/>\n                <Menu.Item name={username} position={\"right\"} header />\n            </Menu>\n            <div>\n                {!id  ? <RoomList  />\n                    : <Room  roomId={id}/>}\n            </div>\n        </React.Fragment>\n    );\n}\n\n\n\n\nfunction stopConnection(pc) {\n    if (pc) {\n        pc.onicecandidate = null;\n        pc.ontrack = null;\n        pc.onnegotiationneeded = null;\n        pc.oniceconnectionstatechange = null;\n        pc.onsignalingstatechange = null;\n        pc.onicegatheringstatechange = null;\n        pc.onnotificationneeded = null;\n        pc.onremovetrack = null;\n\n        pc.close();\n        pc = null;\n\n    }\n}\n\nfunction stopMediaDevices() {\n    checkDeviceSupport(function (hasWebcam, hasMicrophone) {\n        if(hasMicrophone || hasWebcam) {\n            navigator.mediaDevices.getUserMedia({video: hasWebcam, audio: hasMicrophone})\n                .then(function (stream) {\n                    stream.getTracks().forEach(function(track) {\n                        track.stop();\n                    });\n                }).catch(function (e) {\n                console.log(e)\n            });\n        }\n    })\n}\n\n\nconst mapStateToProps = (state) => {\n    const {username, socket} = state.room;\n    return {username, socket};\n}\n\nexport default connect(mapStateToProps, {setUsername, setSocket,  setUsers, setRooms, exit})(RoomPage);","import React, {useEffect, useRef, useState} from \"react\";\nimport {connect} from \"react-redux\";\nimport { getSupportedDevices} from \"../utility/checkDeviceSupport\";\nimport {Dropdown, Icon, Popup} from \"semantic-ui-react\";\n\nexport const peers = {};\n\n\nconst VideoItem = ({socket, username, remoteUser, peerConnectionConfig\n                       , roomId, resetVideo, stream}) => {\n    const [fullscreen, setFullscreen ] = useState(false);\n\n    console.log('stream #######', stream)\n\n\n    useEffect(() => {\n        if(peers[remoteUser]?.pc && peers[remoteUser].sender)\n            changeMedia();\n    }, [stream?.id]);\n\n\n\n    // useEffect(() => {\n    //     const id = setInterval(() => {\n    //         console.log('running ....');\n    //         if(peers[remoteUser].pc  ) {\n    //             if(peers[remoteUser].pc.remoteDescription === null) {\n    //                 console.log('null remoteDescription');\n    //                 sendToServer({\n    //                     from: username,\n    //                     type: 'negotiate',\n    //                     room: roomId,\n    //                     data: remoteUser\n    //                 });\n    //             }else {\n    //                 console.log('removing interval')\n    //                 clearInterval(id);\n    //             }\n    //         }else {\n    //             socket.addEventListener('message',messageHandler)\n    //             sendNegotiateMessage()\n    //         }\n    //     }, 10000)\n    //     return () => clearInterval(id);\n    // }, [])\n\n\n\n\n    window.onbeforeunload = function (e) {\n        stop()\n    };\n\n\n    const remoteVideoRef = useRef();\n\n    useEffect(() => {\n        if(!peers[remoteUser])peers[remoteUser] = {};\n        if(peers[remoteUser].pc) {\n            console.log('STOPPING CONNECTION ...');\n            stop();\n        }\n        peers[remoteUser].pc = null;\n            socket.addEventListener('message',messageHandler)\n            sendNegotiateMessage()\n\n        return () => {\n            console.log('REMOVING VIDEO ITEM');\n            socket.removeEventListener('message',messageHandler)\n            stop();\n        };\n\n        }\n        , []);\n\n    function messageHandler (msg) {\n        let message = JSON.parse(msg.data);\n        let from = message.from;\n        switch (message.type) {\n            case 'negotiate': {\n                if( message.room === roomId && from === remoteUser ) {\n                    console.log('message ', message)\n                    createOfferMessage();\n                }\n                break;\n            }\n            case 'reset': {\n                if(from === remoteUser && message.data === username && message.room === roomId) {\n                    resetVideo();\n                    socket.removeEventListener('message',messageHandler)\n                }\n                break;\n            }\n            case 'offer': {\n                console.log('message ', message)\n                if(from === remoteUser)\n                    handleOfferMessage(message);\n                break;\n            }\n            case \"answer\": {\n                if(from === remoteUser &&  peers[remoteUser].pc )\n                    handleAnswerMessage(message);\n                break;\n            }\n            case \"ice\": {\n                if(from === remoteUser &&  peers[remoteUser].pc)\n                handleNewICECandidateMessage(message);\n                break;\n            }\n            default: {\n                return;\n            }\n\n        }\n    }\n\n\n\n    function sendNegotiateMessage()  {\n        if (!peers[remoteUser].pc  || peers[remoteUser].pc.signalingState === 'closed' ) {\n            sendToServer({\n                from: username,\n                type: 'negotiate',\n                room: roomId,\n                data: remoteUser\n            });\n        }\n    }\n\n    function resetConnection() {\n        sendToServer({\n            from: username,\n            type: 'reset',\n            room: roomId,\n            data: remoteUser\n        });\n        resetVideo();\n        socket.removeEventListener('message',messageHandler)\n\n    }\n\n\n\n    function createPeerConnection() {\n        if(peers[remoteUser].pc) stop();\n        peers[remoteUser].pc = new RTCPeerConnection(peerConnectionConfig);\n        peers[remoteUser].pc.oniceconnectionstatechange = function () {\n            console.log('peer connection ice state ', peers[remoteUser].pc.iceConnectionState , remoteUser);\n        }\n        peers[remoteUser].pc.onsignalingstatechange = function(event) {\n            switch (peers[remoteUser].pc.signalingState) {\n                case \"stable\":\n                    if(!peers[remoteUser].iceCandidate) return;\n                    let candidate = new RTCIceCandidate(peers[remoteUser].iceCandidate);\n                    if(candidate && peers[remoteUser].pc.localDescription && peers[remoteUser].pc.remoteDescription?.type )\n                        peers[remoteUser].pc.addIceCandidate(candidate).catch((e) => console.log('ICE Error ', e));\n                    console.log('Signaling State: Stable');\n                    break;\n                case \"closed\":\n                    console.log('Signaling State: Closed');\n                    break;\n\n\n            }\n        }\n        peers[remoteUser].pc.onconnectionstatechange = function(event) {\n            console.log('Peer connection ', peers[remoteUser].pc.connectionState)\n            switch(peers[remoteUser].pc.connectionState) {\n                case \"connected\":\n                    break;\n                case \"disconnected\":\n                case \"failed\":\n                    console.log('Peer connection ', peers[remoteUser].pc.connectionState , \"event##\", event)\n                    // createOfferMessage();\n                    resetConnection();\n                    break;\n                case \"closed\":\n                    console.log('Peer connection closed')\n                    break;\n            }\n        }\n        peers[remoteUser].pc.addEventListener(\"icegatheringstatechange\",  ev => {\n            switch(peers[remoteUser].pc.iceGatheringState) {\n                case \"new\":\n                    console.log('Ice New')\n                    break;\n                case \"gathering\":\n                    console.log('Ice Gathering')\n                    break;\n                case \"complete\":\n                    console.log('Ice  Complete')\n                    if(remoteVideoRef.current) {\n                        remoteVideoRef.current.play().catch(e => console.log('Failed to play video ', e));\n                    }\n                    break;\n            }\n        });\n        peers[remoteUser].pc.onicecandidate = handleICECandidateEvent;\n        peers[remoteUser].pc.ontrack = handleTrackEvent;\n\n    }\n    function getMedia() {\n        if( peers[remoteUser].pc){\n            console.log('getting media ...' )\n             getSupportedDevices().then(({hasMicrophone, hasWebcam}) => {\n                 if(stream && !peers[remoteUser].sender)\n                     stream.getTracks().forEach(track => peers[remoteUser].sender = peers[remoteUser].pc.addTrack(track, stream) );\n\n             });\n        }\n    }\n\n    function changeMedia() {\n        if(stream)\n            stream.getTracks().forEach(track => peers[remoteUser].sender.replaceTrack(track));\n    }\n\n    function stop() {\n        if (peers[remoteUser].pc) {\n            console.log('disconnect all our event listeners')\n            // disconnect all our event listeners\n            peers[remoteUser].pc.onicecandidate = null;\n            peers[remoteUser].pc.ontrack = null;\n            peers[remoteUser].pc.onnegotiationneeded = null;\n            peers[remoteUser].pc.oniceconnectionstatechange = null;\n            peers[remoteUser].pc.onsignalingstatechange = null;\n            peers[remoteUser].pc.onicegatheringstatechange = null;\n            peers[remoteUser].pc.onnotificationneeded = null;\n            peers[remoteUser].pc.onremovetrack = null;\n            // Stop the videos\n            if (remoteVideoRef.current || remoteVideoRef.current?.srcObject) {\n                if(remoteVideoRef.current.srcObject && remoteVideoRef.current.srcObject.getTracks() !== null)\n                    remoteVideoRef.current.srcObject.getTracks().forEach(track => track.stop());\n                remoteVideoRef.current.pause();\n                // remoteVideoRef.current.srcObject = null;\n            }\n\n            // peers[remoteUser].pc.removeTrack(peers[remoteUser].sender);\n            // close the peer connection\n            peers[remoteUser].videoSender = null;\n            peers[remoteUser].audioSender = null;\n            peers[remoteUser].sender = null;\n            peers[remoteUser].pc.close();\n            peers[remoteUser].pc = null;\n\n            if(peers[remoteUser].iceCandidate) peers[remoteUser].iceCandidate= null;\n            // setMyPeerConnection(null);\n        }\n    }\n    function handleNegotiationNeededEvent() {\n        if(peers[remoteUser].pc.signalingState !== 'stable' ) return ;\n        // peers[remoteUser].pc.createOffer().then(function(offer) {\n        peers[remoteUser].pc.createOffer({offerToReceiveAudio: true, offerToReceiveVideo: true}).then(function(offer) {\n            return peers[remoteUser].pc.setLocalDescription(offer);\n        })\n            .then(function() {\n                sendToServer({\n                    from: username,\n                    type: 'offer',\n                    room: roomId,\n                    sdp: peers[remoteUser].pc.localDescription,\n                    data: remoteUser\n                });\n            })\n            .catch((e) => {\n                console.log('Error ', e);\n                resetConnection()\n\n            });\n    }\n\n\n     function createOfferMessage() {\n        createPeerConnection();\n\n         if(stream) {\n             getMedia();\n             peers[remoteUser].pc.onnegotiationneeded = handleNegotiationNeededEvent;\n         } else {\n             handleNegotiationNeededEvent();\n         }\n\n    }\n\n\n    function handleICECandidateEvent(event) {\n        if (event.candidate) {\n            sendToServer({\n                from: username,\n                type: 'ice',\n                room: roomId,\n                candidate: event.candidate,\n                data: remoteUser\n            });\n        }\n    }\n     const handleTrackEvent =  (event) => {\n        if(remoteVideoRef.current) {\n            console.log('track event', event)\n            // if(remoteVideoRef.current.srcObject && remoteVideoRef.current.srcObject.getTracks() !== null)\n            //     remoteVideoRef.current.srcObject.getTracks().forEach(track => track.stop());\n            remoteVideoRef.current.srcObject = event.streams[0];\n            // await remoteVideoRef.current.play();\n            remoteVideoRef.current.addEventListener('loadedmetadata',  function () {\n                console.log('video on loaded meta data');\n                 if(remoteVideoRef.current) {\n                     // remoteVideoRef.current.muted = true;\n\n                     remoteVideoRef.current.play().catch(e => console.log('Failed to play video ', e));\n                 }\n            })\n\n        }\n    }\n\n    function handleOfferMessage(message) {\n        createPeerConnection();\n        let desc = new RTCSessionDescription(message.sdp);\n        //TODO test this\n        if(peers[remoteUser].pc.signalingState !== 'stable' ) return ;\n        if (desc !== null && message.sdp !== null) {\n            peers[remoteUser].pc.setRemoteDescription(desc)\n                .then(function () {\n                    if(stream)\n                      stream.getTracks().forEach(track => peers[remoteUser].sender = peers[remoteUser].pc.addTrack(track, stream) );\n                })\n                .then(function () {\n                    return peers[remoteUser].pc.createAnswer();\n                })\n                .then(function (answer) {\n                    return peers[remoteUser].pc.setLocalDescription(answer);\n                })\n                .then(function () {\n                    sendToServer({\n                        from: username,\n                        type: 'answer',\n                        room: roomId,\n                        sdp: peers[remoteUser].pc.localDescription,\n                        data: remoteUser\n                    });\n                })\n                .catch((e) => {\n                    console.log('Error handleOfferMessage', e);\n                    resetConnection()\n                })\n        }\n    }\n\n    function handleAnswerMessage(message) {\n            peers[remoteUser].pc.setRemoteDescription(message.sdp).catch((e) => {\n                console.log('Error ', e);\n                resetConnection()\n            });\n\n    }\n\n    function handleNewICECandidateMessage(message) {\n        if(peers[remoteUser].pc) {\n            if( peers[remoteUser].pc.signalingState === 'stable') {\n                let candidate = new RTCIceCandidate(message.candidate);\n                if(candidate && peers[remoteUser].pc.localDescription && peers[remoteUser].pc.remoteDescription?.type )\n                    peers[remoteUser].pc.addIceCandidate(candidate).catch((e) => console.log('ICE Error ', e));\n\n            } else {\n                peers[remoteUser].iceCandidate = message.candidate;\n            }\n\n\n        }\n    }\n\n\n    function sendToServer(msg) {\n        let msgJSON = JSON.stringify(msg);\n            if(socket.readyState === WebSocket.OPEN )\n            socket.send(msgJSON);\n\n    }\n\n    return (\n        <div className={'video-grid__item'}  >\n            <h4  >{remoteUser}</h4>\n            <div className={`${fullscreen ? 'fullscreen' : ''}`} style={{position: 'relative', objectFit: 'cover', width: '100%', height: '100%'}}>\n                <video     ref={remoteVideoRef}  />\n                <div style={{width: 'fit-content' , height: '30px', color: 'white', zIndex: '1'\n                    , position: 'absolute' ,top: '5px', right: '0px', background: 'transparent' }} >\n                    <Popup trigger={<Icon onClick={() => setFullscreen(!fullscreen)} name={`${fullscreen ? 'compress' : 'expand'}`} link size={\"large\"} /> }\n                           content={`${fullscreen ? 'Exit full screen' : 'Full screen'}`} /></div>\n                <div style={{width: 'fit-content' , height: '30px', color: 'white', zIndex: '1', fontSize: 'large', fontWeight: 'bolder'\n                    , position: 'absolute' ,top: '5px', left: '10px', background: 'transparent' }} >{fullscreen ? remoteUser : ''}</div>\n            </div>\n        </div>\n    );\n\n}\n\nconst mapStateToProps = (state) => {\n    const  {   stream} = state.media;\n    const {socket} = state.room;\n    return { socket, stream}\n}\n\nexport default connect(mapStateToProps, {})(VideoItem);","\n\n\n\n\n\nexport const  getUserMedia = async ( {video, audio}) => {\n    try {\n        // return  await navigator.mediaDevices.getUserMedia({video , audio});\n        let vi = false ;\n        if(video) {\n            vi =  {width: {exact: 400}, height: {exact: 400}, facingMode: \"user\"}\n        }\n        return  await navigator.mediaDevices.getUserMedia({video: vi , audio});\n\n    }catch (e) {\n        console.log(e, video, audio);\n        return null;\n        // alert(\"Error opening your camera and/or microphone \");\n    }\n}\n\nexport const getDisplayMedia = async ({video, audio}) => {\n\n    try {\n        // return await navigator.mediaDevices.getDisplayMedia({video, audio});\n        let vi = false ;\n        if(video) {\n            vi =  {width: {exact: 400}, height: {exact: 400}, facingMode: \"user\"}\n        }\n        return await navigator.mediaDevices.getDisplayMedia({video: vi, audio});\n    }catch (e) {\n        console.log(e);\n        return null;\n        // alert(\"Error capture your screen\")\n    }\n}\n\n\n","\nexport const SET_USERNAME =  'SET USERNAME';\n\nexport const SET_SOCKET = 'SET SOCKET';\n\nexport const SET_ROOMS = 'SET ROOMS';\n\nexport const SET_USERS = 'SET USERS';\n\nexport const ADD_MESSAGE = 'ADD MESSAGE';\n\n\nexport const CLEAR_MESSAGES = 'CLEAR MESSAGES';\n\n\n\nexport const SET_CAM_STREAM =  'SET CAM STREAM';\n\nexport const SET_SCREEN_STREAM = 'SET SCREEN STREAM';\n\nexport const SET_AUDIO_STREAM = 'SET AUDIO STREAM';\n\n\nexport const SET_MEDIA_CONSTRAINTS = 'SET MEDIA CONSTRAINTS';\n\nexport const SET_MEDIA_SOURCE = 'SET MEDIA SOURCE'\n\n\n\nexport const EXIT = \"EXIT\";","import {ADD_MESSAGE, EXIT, SET_USERS, SET_ROOMS, SET_SOCKET, SET_USERNAME} from \"./types\";\n\n\nexport const setUsername = (username) => {\n    return {type: SET_USERNAME, payload: username};\n}\n\n\nexport const setSocket = (socket) => {\n    return {type: SET_SOCKET, payload: socket};\n}\n\nexport const setRooms = (rooms) => {\n    return {type: SET_ROOMS, payload: rooms};\n}\n\nexport const setUsers = (clients) => {\n    return {type: SET_USERS , payload: clients};\n}\n\nexport const addMessage = (message) => {\n    return {type: ADD_MESSAGE, payload: message};\n}\n\nexport const clearMessages = () => {\n    return {type: ADD_MESSAGE};\n}\n\n\nexport const exit = () => {\n    return {type: EXIT};\n}","import React, {useState, useEffect, useRef} from \"react\";\nimport {connect} from \"react-redux\";\nimport {Dropdown, Icon, Popup} from \"semantic-ui-react\";\nimport {checkDeviceSupport} from \"../utility/checkDeviceSupport\";\nimport {getDisplayMedia, getUserMedia} from \"../utility/getMediaDevices\";\n\nimport {addMessage} from '../actions/room';\n\n\nimport {setCamStream, setScreenStream, setMediaConstraints, setMediaSource} from '../actions/media';\n\nconst LocalVideo = ({ source,  setReadyToJoin\n                        ,mediaConstraints,  setCamStream, setScreenStream, setMediaConstraints, setMediaSource }) => {\n\n    const localVideoRef = useRef();\n\n    useEffect(() => {\n        checkDeviceSupport(function (hasWebcam, hasMicrophone) {\n            setMediaConstraints({ video: hasWebcam,  audio: hasMicrophone});\n        })\n    }, []);\n\n    useEffect(() => {\n        const {video , audio} = mediaConstraints;\n        if(video ||  audio)\n            getMedia();\n    }, [mediaConstraints, source]);\n\n\n\n\n    function getMedia() {\n        const {video , audio} = mediaConstraints;\n        checkDeviceSupport(function (hasWebcam, hasMicrophone) {\n            const constraints = {video: hasWebcam && video, audio: hasMicrophone && audio};\n            if(!constraints.video && !constraints.audio) {\n                setReadyToJoin(true)\n                return;\n            }\n            if(source === 'camera') {\n                getUserMedia(constraints).then(getLocalMediaStream).finally(() => setReadyToJoin(true));\n            }else {\n                getDisplayMedia(constraints).then(getScreenMediaStream).finally(() => setReadyToJoin(true));\n            }\n        })\n    }\n\n    function  changeConstraints ({video, audio}) {\n\n        checkDeviceSupport(function (hasWebcam, hasMicrophone) {\n\n            const constraints = {video: hasWebcam && video, audio: hasMicrophone && audio};\n            setMediaConstraints(constraints);\n            // getMedia();\n        })\n\n    }\n\n    async function getLocalMediaStream(mediaStream) {\n        if(!mediaStream) {\n            setCamStream(null);\n            return;\n        }\n        if(localVideoRef.current) {\n            setCamStream(mediaStream);\n             localVideoRef.current.pause()\n            localVideoRef.current.srcObject = mediaStream;\n            localVideoRef.current.muted =true;\n          await  localVideoRef.current.play();\n        }\n\n    }\n    async function getScreenMediaStream(mediaStream) {\n        if(!mediaStream) {\n            setCamStream(null);\n            return;\n        }\n        if(localVideoRef.current) {\n            setScreenStream(mediaStream);\n             localVideoRef.current.pause()\n\n            localVideoRef.current.srcObject = mediaStream;\n            localVideoRef.current.muted =true;\n          await  localVideoRef.current.play();\n        }\n    }\n\n    const renderVolumeIcon = () => {\n        if(mediaConstraints.audio)\n            return <Icon style={{fontSize: '16px', textAlign: 'center' }} name={'unmute'} link\n                         onClick={() => changeConstraints({...mediaConstraints, audio: false})} />;\n        return (\n            <Icon style={{fontSize: '16px', textAlign: 'center' }} name={'mute'} link onClick={() => changeConstraints({...mediaConstraints, audio: true})} />\n        );\n    }\n\n    const renderVideoIcon = () => {\n        if(mediaConstraints.video)\n            return <Icon name={'video camera'} link onClick={() => changeConstraints({...mediaConstraints, video: false})}  />\n        return (\n            <Icon.Group style={{fontSize: '16px'}} onClick={() => changeConstraints({...mediaConstraints, video: true})} >\n                <Icon name={'video camera'} link  />\n                <Icon corner name='cancel' color={'red'}  />\n            </Icon.Group>\n        );\n    }\n    return (\n        <div className={'video-grid__item'}>\n            <div style={{display: \"flex\", flexDirection: \"row\", alignItems: \"baseline\", gap: '0', justifyContent: \"space-between\"}}>\n                <div />\n                <h3 style={{margin: '0 0 0px 0px' , color: 'rgba(0, 147, 208, 1)'}} >You</h3>\n                <span>\n                    <Popup trigger={renderVolumeIcon()}  content={'audio'}  />\n                    <Popup trigger={renderVideoIcon()} content={'video'}  />\n\n                    <Dropdown floating icon={{name: 'ellipsis vertical'}} >\n                        <Dropdown.Menu>\n                            <Dropdown.Item disabled={!navigator.mediaDevices.getDisplayMedia} onClick={() => {\n                                setMediaSource(source === 'camera' ? 'screen' : 'camera');\n                                // getMedia()\n                            }} >\n                                Share  {source === 'camera' ? 'Screen' : 'Camera'} Video</Dropdown.Item>\n                        </Dropdown.Menu>\n\n                    </Dropdown>\n                </span>\n            </div>\n            <video  ref={localVideoRef} />\n        </div>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    const  {camStream, screenStream, mediaConstraints, source} = state.media;\n    const  {socket , username} = state.room;\n    return {socket , username, camStream, screenStream, mediaConstraints, source};\n}\n\nexport default connect(mapStateToProps, {addMessage, setCamStream, setScreenStream, setMediaConstraints, setMediaSource})(LocalVideo);","import { SET_CAM_STREAM, SET_MEDIA_CONSTRAINTS, SET_MEDIA_SOURCE, SET_SCREEN_STREAM} from \"./types\";\n\n\nexport const setCamStream = (stream) => {\n    return {type: SET_CAM_STREAM, payload: stream};\n}\n\nexport const setScreenStream = (stream) => {\n    return {type: SET_SCREEN_STREAM, payload: stream};\n}\n\n\n\nexport const setMediaConstraints = (constraints) => {\n    return {type: SET_MEDIA_CONSTRAINTS, payload: constraints};\n}\n\nexport const setMediaSource = (source) => {\n    return {type: SET_MEDIA_SOURCE, payload: source};\n}","import React , {useState, useEffect} from \"react\";\nimport {connect} from \"react-redux\";\nimport _ from 'lodash';\n\nimport './VideoList.css';\nimport VideoItem from \"./VideoItem\";\nimport {Dimmer, Loader} from \"semantic-ui-react\";\nimport LocalVideo from \"./LocalVideo\";\n\n\nimport {addMessage} from '../actions/room';\n\nconst peerConnectionConfig = {\n    'iceServers': [\n        // {'urls': 'stun:stun.gmx.net:3478'},\n        // {'urls': 'stun:stun.stunprotocol.org:3478'},\n        // {'urls': 'stun:stun.l.google.com:19302'},\n        // {\n        //     url: 'turn:turn.anyfirewall.com:443?transport=tcp',\n        //     credential: 'webrtc',\n        //     username: 'webrtc'\n        // },\n        // {\n        //     url: 'turn:numb.viagenie.ca',\n        //     credential: 'muazkh',\n        //     username: 'webrtc@live.com'\n        // },\n    ]\n};\n\nconst VideoContainer = ({ socket, addMessage,username, room, roomId}) => {\n\n    const [readyToJoin , setReadyToJoin] = useState(false);\n\n    useEffect(() => {\n        if(readyToJoin) {\n            socket.send(JSON.stringify({type: 'join_room', from: username, data: roomId}))\n            socket.addEventListener('message' , function (msg) {\n                const message = JSON.parse(msg.data);\n                if(message.type === 'text') {\n                    // dispatch({type: 'ADD_MESSAGE', payload: {from: message.from, text: message.data}})\n                    addMessage({from: message.from, text: message.data});\n                }\n            })\n        }\n    } , [readyToJoin])\n\n\n\n    function handleGetUserMediaError(error) {\n        switch(error.name) {\n            case \"NotFoundError\":\n                alert(\"Unable to open your call because no camera and/or microphone were found.\");\n                break;\n            case \"SecurityError\":\n            case \"PermissionDeniedError\":\n                break;\n            default:\n                alert(\"Error opening your camera and/or microphone: \" + error.message);\n                break;\n        }\n    }\n    return (\n        <div className={'video-grid'}>\n\n            <LocalVideo   roomId={roomId}  setReadyToJoin={setReadyToJoin}   />\n            {_.chain(room?.users).filter((u) => u !== username).map((r) => {\n\n                if(!readyToJoin) return <div key={r}>Loading...</div>;\n                return (\n\n                    <PeerVideo key={r}   roomId={roomId} username={username}  remoteUser={r}\n                                    />\n                );\n            }).value()}\n        </div>\n    );\n}\n\n\n\nconst PeerVideo = ({ username, remoteUser ,roomId}) => {\n    const [loading, setLoading ]= useState(false);\n    useEffect(() => {\n        if(loading) {\n            setTimeout(() => {\n                setLoading(false)\n            }, 5000);\n        }\n    } ,[loading])\n    if(loading) return <Dimmer.Dimmable className={'video-grid__item'} dimmed >\n        <Loader active={loading} style={{border: 0}} />\n    </Dimmer.Dimmable>;\n    return (\n        <React.Fragment>\n            <VideoItem key={remoteUser}    remoteUser={remoteUser}\n                       username={username}  peerConnectionConfig={peerConnectionConfig} roomId={roomId} resetVideo={() => setLoading(true)}   />\n        </React.Fragment>\n    );\n}\n\n\nconst mapStateToProps = (state, props) => {\n    const roomId = props.roomId;\n    const {username, rooms , socket} = state.room;\n    const room = rooms[roomId];\n\n\n    const {stream} = state.media;\n    return {username, room: room , socket, stream};\n}\n\nexport default connect(mapStateToProps, {addMessage})(VideoContainer);","import React, { useState} from \"react\";\nimport {connect} from \"react-redux\";\nimport _ from 'lodash';\nimport {Divider, Grid, Header} from \"semantic-ui-react\";\n\nimport './Room.css'\nimport VideoContainer from \"./VideoList\";\n\n\nconst Room = ({ username, socket, messages,room,  roomId}) => {\n\n\n\n\n\n    const renderUserMessage = (msg, color) => {\n        return (\n           <div>\n               { msg.from !== username ? <div style={{color: `${color ? color : 'black'}`}} className={` message`}>\n                       <b>{msg.from}: </b>\n                       <div>\n                           {msg.text}\n                       </div>\n                   </div> :\n                   <div style={{color: `${color ? color : 'black'}`, display: 'flex', flexDirection: 'row', justifyContent: 'space-between', }}>\n                       <div/>\n                       <div className={'blue message'}>\n                           {msg.text}\n                       </div>\n                   </div> }\n           </div>\n        );\n    }\n\n\n    const renderRoomUsers = () => {\n        return (\n            <React.Fragment>\n                <Header textAlign={\"center\"}>Users</Header>\n                <Divider fitted />\n                {_.map(room?.users, (u , i) => {\n                     return (\n                        <React.Fragment key={i}>\n                            <div  style={{fontWeight: \"bold\" , fontSize: '12px', padding: '6px 6px'}}  >\n                                {u}\n                            </div>\n                            <Divider fitted style={{backgroundColor: 'rgba(208, 173, 0, 0.1)'}} />\n                        </React.Fragment>\n                    );\n                    return ;\n                })\n                }\n            </React.Fragment>\n        );\n    }\n    const renderChats =() => {\n        return (\n                <div className={'chat'} >\n                    <div className={'chat__clients'}>\n                        {renderRoomUsers()}\n                    </div>\n                    <div className={'chat__messages'}>\n\n                        {_.map(messages, (m, i) => (\n                            <React.Fragment key={i}>\n                                {renderUserMessage(m)}\n                            </React.Fragment>\n                        ))}\n                    </div>\n                    <ChatInput onSend={(value) => {\n                        return socket.send(JSON.stringify({type: 'text', from: username, data: value, room: roomId}));\n                    }} />\n                </div>\n\n        );\n    }\n\n\n    const renderMedias = () => {\n\n        return (\n            <div style={{margin: '50px 0 0 10px'}}>\n                <VideoContainer  roomId={roomId}/>\n            </div>\n        );\n    }\n\n\n\n\n    return (\n        <div >\n\n            <Grid  id={'room'} stackable >\n                <Grid.Row  style={{padding: '8px 0 0 0'}}>\n                    <Grid.Column largeScreen={11}  >{renderMedias()}</Grid.Column>\n                    <Grid.Column largeScreen={5}  >{renderChats()}</Grid.Column>\n                </Grid.Row>\n            </Grid>\n        </div>\n    );\n}\n\nconst ChatInput = ({onSend}) => {\n    const [value, setValue] = useState('');\n\n    const  onSendHandler = () => {\n        onSend(value)\n        setValue('')\n    }\n    return (\n        <div className={'chat__inputs'}>\n            <input  value={value} onKeyDown={(e) =>{\n                if(e.key === 'Enter') onSendHandler();\n            } }  onChange={event => setValue(event.target.value) } />\n            <button onClick={onSendHandler}>Send</button>\n        </div>\n    );\n}\n\n\nconst mapStateToProps = (state, props) => {\n    const roomId = props.roomId;\n    const {username, socket, messages, rooms } = state.room;\n    const room = rooms[roomId];\n    return {username, socket, messages, room };\n}\n\nexport default connect(mapStateToProps, {})(Room);","import React from \"react\";\nimport {Switch, Route, Router, Redirect} from 'react-router-dom';\n\nimport history from \"./history\";\nimport Login from \"./components/Login\";\nimport RoomPage from \"./components/RoomPage\";\n\n\nconst Routes = () => {\n\n\n    return (\n        <Router history={history}>\n                <Switch>\n                    <Route exact path={'/'} >\n                        <Redirect to={'/login'} />\n                    </Route>\n                    <Route exact path={'/login'} component={Login} />\n                    <Route exact path={'/room'} component={RoomPage} />\n                    <Route exact path={'/room/:id'} component={RoomPage} />\n                    <Routes />\n\n                </Switch>\n        </Router>\n    );\n}\n\nexport default Routes;","import React from \"react\";\nimport Routes from \"./Routes\";\n\nfunction App() {\n\n\n\n\n    return (\n        <Routes />\n    );\n\n}\n\nexport default App;\n","import _ from \"lodash\";\nimport {ADD_MESSAGE, CLEAR_MESSAGES, SET_USERS, SET_ROOMS, SET_SOCKET, SET_USERNAME} from \"../actions/types\";\n\n\nconst INITIAL_STATE = {\n    username: '',\n    socket: null,\n    rooms: {},\n    users: {},\n    messages: [],\n}\n\n\nexport const roomReducer = (state = INITIAL_STATE, action) => {\n\n    switch (action.type) {\n        case SET_USERNAME: {\n            return {...state, username: action.payload};\n        }\n        case SET_SOCKET : {\n            return {...state, socket: action.payload};\n        }\n        case SET_ROOMS: {\n            return {...state, rooms: _.mapKeys(action.payload , 'name')};\n        }\n        case SET_USERS: {\n            return  {...state, users: action.payload};\n        }\n        case ADD_MESSAGE :{\n            return  {...state, messages: [...state.messages, action.payload]}\n        }\n        case CLEAR_MESSAGES: {\n            return  {...state, messages:  []};\n        }\n        default: {\n            return state;\n        }\n    }\n\n\n}","import {\n    SET_CAM_STREAM,\n    SET_MEDIA_CONSTRAINTS,\n    SET_MEDIA_SOURCE,\n    SET_SCREEN_STREAM\n} from \"../actions/types\";\n\n\nconst INITIAL_STATE = {\n    camStream: null,\n    screenStream: null,\n    stream: null,\n    mediaConstraints: {video: true, audio: true},\n    source: 'camera',\n}\n\n\nexport const mediaReducer = (state = INITIAL_STATE, action) => {\n\n    switch (action.type) {\n        case SET_CAM_STREAM: {\n            const camStream = action.payload;\n            if(!camStream) return state;\n           // const {stream} = state;\n           // if(stream) {\n           //     state.stream.getVideoTracks().forEach(track => track.stop());\n           //     state.stream.getAudioTracks().forEach(track => track.stop());\n           // }\n            return {...state, camStream , stream: camStream};\n        }\n        case SET_SCREEN_STREAM: {\n            const screenStream = action.payload;\n            if(!screenStream) return state;\n            // const {stream} = state;\n            // if(stream) {\n            //     state.stream.getVideoTracks().forEach(track => track.stop());\n            //     state.stream.getAudioTracks().forEach(track => track.stop());\n            // }\n            return {...state, screenStream , stream: screenStream};\n        }\n        case SET_MEDIA_CONSTRAINTS: {\n            const constraints = action.payload;\n            const  {video, audio } = constraints;\n            const stream = state.stream;\n            if(stream) {\n                    //  stream.getVideoTracks().forEach(track => track.enabled = video)\n                    // stream.getAudioTracks().forEach(track => track.enabled = audio);\n                if(video === false) stream.getVideoTracks().forEach(track => track.stop() )\n                if(audio === false) stream.getAudioTracks().forEach(track => track.stop() )\n            }\n            return {...state, mediaConstraints:  action.payload, stream: stream};\n        }\n        case SET_MEDIA_SOURCE: {\n            const source = action.payload;\n            return {...state, source};\n        }\n\n        default: {\n            return state;\n        }\n    }\n}","\nimport {combineReducers} from \"redux\";\nimport {roomReducer} from \"./room\";\nimport {mediaReducer} from \"./media\";\n\n\n\nexport default combineReducers({\n    room: roomReducer,\n    media: mediaReducer\n});","import {createStore, compose} from \"redux\";\n\nimport reducers from './reducers';\nimport {EXIT} from \"./actions/types\";\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\nconst rootReducer = (state, action) => {\n    if(action.type  === EXIT) {\n        return reducers(undefined, action);\n    }\n    return reducers(state, action);\n};\n\nconst store = createStore(rootReducer, composeEnhancers());\n\n\n\nexport default store;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport 'semantic-ui-css/semantic.min.css';\nimport {Provider} from 'react-redux';\nimport store from \"./store\";\n\nReactDOM.render(\n    <Provider store={store}>\n        <App />\n    </Provider> ,\n  document.getElementById('root')\n);\n\n\n"],"sourceRoot":""}